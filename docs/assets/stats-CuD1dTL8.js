import{d as U,m as Q,c as $,n as W,u as p,o as v,w as r,a as N,t as w,b as _,e as o,f as x,r as X,F as Z,g as s,h as tt,i as l,j as A,k as et,l as st,p as nt,_ as at,q as ot}from"./kemov-_plugin-vue_export-helper-BfvHD29s.js";import{c as y,a as rt,b as it,d as lt}from"./kemov-main--jwohN0k.js";import{t as V,u as j,a as ct,_ as ut,c as dt,s as vt,l as ft}from"./kemov-StatsAppBase.vue_vue_type_script_setup_true_lang-CpG836Ar.js";import{c as mt,g as gt,d as k,r as D,a as H,b as pt}from"./kemov-axios-CRW72lKU.js";const bt={dark:!1,colors:{background:"#F4F5FA",primary:y.indigo.base,secondary:y.indigo.base,positive:y.green.darken3,negative:y.red.darken3,v2DrawerBackground:"#ffffff",v2DrawerList:"#3c3c43",v2DrawerListActive:y.indigo.base,v2AppBarBackground:"#ffffff",v2SnackbarBackground:"#171717"},variables:{"high-emphasis-opacity":"1.0","v2-content-color":"#3c3c43","v2-snackbar-border":"none"}},ht={dark:!0,colors:{background:"#121212",primary:y.indigo.lighten4,secondary:y.indigo.darken4,positive:y.green.lighten2,negative:y.red.lighten1,v2DrawerBackground:"#171717",v2DrawerList:"#bcbcbc",v2DrawerListActive:y.blue.lighten2,v2AppBarBackground:"#171717",v2SnackbarBackground:"#171717"},variables:{"high-emphasis-opacity":"0.86","v2-content-color":"rgba(255, 255, 245, .86)","v2-snackbar-border":"1px solid #3c3c43"}},yt={themes:{defaultTheme:"light",light:bt,dark:ht},variations:{colors:["primary","secondary","positive","negative"],lighten:0,darken:0}},F=U({__name:"DifferenceValue",props:Q({value:null,strong:null,positiveClass:null,negativeClass:null,strongClass:null,tag:null},{positiveClass:["text-positive"],negativeClass:["text-negative"],strongClass:["font-weight-bold"],tag:"span"}),setup(t){const f=t.tag;function c(i){return i===0?"":i>0?`+${V(i)}`:`${V(i)}`}function m(i){return i===0?[""]:i>=t.strong?[...t.positiveClass,...t.strongClass]:i<=-t.strong?[...t.negativeClass,...t.strongClass]:i>0?[...t.positiveClass]:[...t.negativeClass]}return(i,g)=>(v(),$(p(f),{class:W(m(i.value))},{default:r(()=>[N(w(c(i.value)),1)]),_:1},8,["class"]))}});var Y={exports:{}};(function(t,f){(function(c,m){t.exports=m()})(mt,function(){return function(c,m,i){m.prototype.isBetween=function(g,C,u,b){var a=i(g),h=i(C),e=(b=b||"()")[0]==="(",n=b[1]===")";return(e?this.isAfter(a,u):!this.isBefore(a,u))&&(n?this.isBefore(h,u):!this.isAfter(h,u))||(e?this.isBefore(a,u):!this.isAfter(a,u))&&(n?this.isAfter(h,u):!this.isBefore(h,u))}}})})(Y);var _t=Y.exports;const xt=gt(_t),wt={key:0},kt={scope:"col",class:"px-2 text-right font-weight-bold"},Ct={key:0,scope:"col",class:"px-2 text-right font-weight-bold"},Bt={scope:"row",class:"channel-name-head pl-4 pr-2"},St={class:"channel-name-box"},Dt={class:"channel-name-text"},At={key:0,class:"has-live"},Vt={key:1,class:"has-live-before-start"},$t={class:"px-2 text-h6"},Nt={key:0},Tt={colspan:"4",class:"pa-4 text-center"},Lt={key:1},Pt={class:"text-right text-h6"},Ft={scope:"row",class:"pl-4 pr-2 text-right text-body-1 font-weight-bold"},Ut={class:"mt-n4"},Et={class:"mt-n4"},Mt={class:"mt-n4"},Ht={class:"px-2"},It=U({__name:"StatTable",props:{channels:null,latestStreamings:null,type:null,activeOnly:{type:Boolean}},setup(t){k.extend(xt);function f(){switch(t.type){case"subscriber":return"登録数";case"view":return"再生数";case"video":return"動画数"}}function c(e){switch(t.type){case"subscriber":return e.statistics.subscriberCount;case"view":return e.statistics.viewCount;case"video":return e.statistics.videoCount}}function m(e){switch(t.type){case"subscriber":return e.statistics.subscriberCountPerHour;case"view":return e.statistics.viewCountPerHour;case"video":return e.statistics.videoCountPerHour}}function i(e){switch(t.type){case"subscriber":return e.statistics.subscriberCountPerDay;case"view":return e.statistics.viewCountPerDay;case"video":return e.statistics.videoCountPerDay}}function g(){switch(t.type){case"subscriber":return 100;case"view":return 1e3;case"video":return 10}}function C(e){return e>=1e3?e+10**(BigInt(e).toString().length-3)-1:e}function u(){const e=D(t.channels,c);return Math.round(e+(D(t.channels,n=>C(c(n)))-e)/2)}function b(e){return t.activeOnly&&typeof e.activityEndDate=="string"?k().isBefore(e.activityEndDate):!0}function a(e){const n=t.latestStreamings.find(S=>S.channelId===e);return typeof n<"u"&&n.success&&n.isLiveBroadcast===!0&&k().isAfter(n.startedAt)}function h(e){const n=t.latestStreamings.find(S=>S.channelId===e);return typeof n<"u"&&n.success&&n.isLiveBroadcast===!0&&k().isBetween(n.startedAt,k(n.startedAt).add(-1,"hour"))}return(e,n)=>{const S=l("v-img"),T=l("v-avatar"),L=l("v-list-item"),E=l("v-progress-circular"),P=l("v-btn"),B=l("v-card-text"),M=l("v-timeline-item"),O=l("v-timeline"),R=l("v-spacer"),q=l("v-card-actions"),G=l("v-card"),J=l("v-dialog"),K=l("v-table");return v(),$(K,{density:"compact",hover:""},{default:r(()=>[t.channels.length!==0?(v(),_("thead",wt,[o("tr",null,[n[0]||(n[0]=o("th",{scope:"col",class:"pl-4 pr-2"}," ",-1)),o("th",kt,w(f()),1),t.type==="subscriber"?(v(),_("th",Ct,"1時間")):x("",!0),n[1]||(n[1]=o("th",{scope:"col",class:"pl-2 pr-4 text-right font-weight-bold"},"24時間",-1))])])):x("",!0),o("tbody",null,[(v(!0),_(Z,null,X(t.channels.filter(b),d=>(v(),_("tr",{class:"channel text-right",key:d.id},[o("th",Bt,[s(L,{class:"channel-name text-left px-0",href:`https://www.youtube.com/${d.customUrl}`,ripple:!1,slim:""},{title:r(()=>[o("div",St,[o("span",Dt,w(d.name),1)])]),prepend:r(()=>[a(d.id)?(v(),_("div",At)):h(d.id)?(v(),_("div",Vt)):x("",!0),s(T,{class:"avatar",color:d.color.key,variant:"outlined",size:"small"},{default:r(()=>[s(S,{src:d.thumbnails.default.url,alt:d.fullname},null,8,["src","alt"])]),_:2},1032,["color"])]),_:2},1032,["href"])]),o("td",$t,w(p(V)(c(d))),1),t.type==="subscriber"?(v(),$(F,{key:0,class:"px-2 text-h6",value:m(d),strong:g(),tag:"td"},null,8,["value","strong"])):x("",!0),s(F,{class:"pl-2 pr-4 text-h6",value:i(d),strong:g(),tag:"td"},null,8,["value","strong"])]))),128)),t.channels.length===0?(v(),_("tr",Nt,[o("td",Tt,[s(E,{color:"primary",indeterminate:""})])])):x("",!0)]),t.channels.length!==0?(v(),_("tfoot",Lt,[o("tr",Pt,[o("th",Ft,[t.type==="subscriber"?(v(),$(J,{key:0,"max-width":"640"},{activator:r(({props:d})=>[s(P,tt(d,{icon:"mdi-information-outline",variant:"plain",density:"compact","aria-label":"チャンネル登録者数について"}),null,16)]),default:r(({isActive:d})=>[s(G,{title:"チャンネル登録者数について"},{default:r(()=>[s(B,null,{default:r(()=>n[2]||(n[2]=[o("p",null," YouTube の制約により、チャンネル登録者数の正確な数値はチャンネルの所有者のみに開示されます。 それ以外の利用者には数値の上位3桁のみが開示されます。 ",-1),o("p",null," したがって、このサイトで表示している数値は上位3桁のみの最小値であり、正確な数値はこれ以上となります。 下記の数値は合計値の参考としてお考えください。 ",-1)])),_:1}),s(B,null,{default:r(()=>[s(O,{class:"text-center",direction:"horizontal",side:"end",size:"small",density:"compact"},{default:r(()=>[s(M,{icon:"mdi-flag-checkered","dot-color":"green"},{default:r(()=>[o("div",Ut,[o("p",null,w(p(V)(p(D)(t.channels,c))),1),n[3]||(n[3]=o("div",{class:"font-weight-bold text-body-2"},"最小値",-1))])]),_:1}),s(M,{icon:"mdi-flag-checkered","dot-color":"orange-darken-1"},{default:r(()=>[o("div",Et,[o("p",null,w(p(V)(u())),1),n[4]||(n[4]=o("div",{class:"font-weight-bold text-body-2"},"平均値",-1))])]),_:1}),s(M,{icon:"mdi-flag-checkered","dot-color":"red"},{default:r(()=>[o("div",Mt,[o("p",null,w(p(V)(p(D)(t.channels,I=>C(c(I))))),1),n[5]||(n[5]=o("div",{class:"font-weight-bold text-body-2"},"最大値",-1))])]),_:1})]),_:1})]),_:1}),s(q,null,{default:r(()=>[s(R),s(P,{text:"閉じる",onClick:I=>d.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1})):x("",!0),n[6]||(n[6]=N(" 合計 "))]),o("td",Ht,w(p(V)(p(D)(t.channels,c))),1),t.type==="subscriber"?(v(),$(F,{key:0,class:"px-2",value:p(D)(t.channels,m),strong:g(),tag:"td"},null,8,["value","strong"])):x("",!0),s(F,{class:"pl-2 pr-4",value:p(D)(t.channels,i),strong:g(),tag:"td"},null,8,["value","strong"])])])):x("",!0)]),_:1})}}}),jt={key:0,class:"update-time"},Yt=U({__name:"UpdateTime",props:{time:null},setup(t){const f=A(Number.NaN),c=et(()=>f.value>=60?`${Math.floor(f.value/60)}分`:`${f.value}秒`);function m(){f.value=k().diff(t.time,"s")}return j(m,1e3),st(()=>t.time,m),(i,g)=>t.time.isValid()&&!Number.isNaN(f.value)?(v(),_("div",jt,w(`${t.time.format("YYYY/MM/DD HH:mm:ss")} (${c.value}前) 更新`),1)):x("",!0)}}),zt=U({__name:"StatsApp",setup(t){const f=A([]),c=A([]),m=A(k(Number.NaN)),i=A("subscriber"),g=ct("kemov/stats/activeOnly",!1),C=A(1e3),u=A();return j(async()=>{try{u.value=!1;const b=(await H.get(dt)).data,a=(await H.get(vt)).data;f.value=pt("id",b,a.data),c.value=(await H.get(ft)).data.data,m.value=k.unix(a.fetched_at),C.value=Math.max(Math.floor(600-(k().unix()-a.fetched_at))+5,30)*1e3}catch(b){console.error(`Fetching error. Retrying in 10 minutes: ${b}`),u.value=!0,C.value=600*1e3}},C),(b,a)=>{const h=l("v-icon"),e=l("v-tab"),n=l("v-tabs"),S=l("v-card"),T=l("v-col"),L=l("v-row"),E=l("v-checkbox"),P=l("v-footer");return v(),$(ut,{"page-id":"stats",title:"けもV リアルタイム統計",channels:f.value,"error-snackbar-shown":u.value,"onUpdate:errorSnackbarShown":a[2]||(a[2]=B=>u.value=B)},{footer:r(()=>[s(P,{class:"bg-secondary text-left d-flex flex-column mt-10"},{default:r(()=>a[9]||(a[9]=[o("ul",null,[o("li",null,"およそ10分ごとに自動で更新されます。数値は減少することがあります"),o("li",null,"総再生数と配信・動画数は配信終了後から反映されます"),o("li",null,"このサイトは非公式のファンサイトです")],-1)])),_:1})]),default:r(()=>[s(L,{justify:"center"},{default:r(()=>[s(T,{cols:"12",md:"12",lg:"10",xl:"7",xxl:"6"},{default:r(()=>[s(n,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=B=>i.value=B),color:"primary","align-tabs":"center",density:"compact"},{default:r(()=>[s(e,{value:"subscriber"},{default:r(()=>[s(h,{start:""},{default:r(()=>a[3]||(a[3]=[N("mdi-account-check")])),_:1}),a[4]||(a[4]=o("span",{class:"font-weight-bold"},"チャンネル登録者数",-1))]),_:1}),s(e,{value:"view"},{default:r(()=>[s(h,{start:""},{default:r(()=>a[5]||(a[5]=[N("mdi-play")])),_:1}),a[6]||(a[6]=o("span",{class:"font-weight-bold"},"総再生数",-1))]),_:1}),s(e,{value:"video"},{default:r(()=>[s(h,{start:""},{default:r(()=>a[7]||(a[7]=[N("mdi-video")])),_:1}),a[8]||(a[8]=o("span",{class:"font-weight-bold"},"配信・動画数",-1))]),_:1})]),_:1},8,["modelValue"]),s(It,{channels:f.value,"latest-streamings":c.value,type:i.value,"active-only":p(g)},null,8,["channels","latest-streamings","type","active-only"]),s(S,{class:"text-right px-4 py-2",variant:"flat"},{default:r(()=>[s(Yt,{class:"update-time",time:m.value},null,8,["time"])]),_:1})]),_:1})]),_:1}),s(L,null,{default:r(()=>[s(T,null,{default:r(()=>[s(E,{modelValue:p(g),"onUpdate:modelValue":a[1]||(a[1]=B=>nt(g)?g.value=B:null),class:"active-only",label:"活動中の配信者のみ表示","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["channels","error-snackbar-shown"])}}}),Ot=at(zt,[["__scopeId","data-v-7ee1e910"]]),Rt=rt({components:it,directives:lt,icons:{defaultSet:"mdi"},theme:yt}),z=ot(Ot);z.use(Rt);z.mount("#app");
