import{d as F,m as X,c as L,n as Z,u as m,o as f,w as r,a as T,t as B,b as x,e as o,f as C,r as tt,F as et,g as s,h as st,i as l,j as N,k as nt,l as at,p as ot,_ as rt,q as it}from"./kemov-_plugin-vue_export-helper-DPqxsgA-.js";import{c as k,a as lt,b as ct,d as ut}from"./kemov-main-Gv-MiTgi.js";import{t as V,u as dt,a as z,b as vt,_ as ft,c as mt,s as gt,l as bt}from"./kemov-StatsAppBase.vue_vue_type_script_setup_true_lang-B8oz652U.js";import{c as ht,g as pt,d as b,r as A,a as M,b as yt}from"./kemov-axios-CRW72lKU.js";const _t={dark:!1,colors:{background:"#F4F5FA",primary:k.indigo.base,secondary:k.indigo.base,positive:k.green.darken3,negative:k.red.darken3,v2DrawerBackground:"#ffffff",v2DrawerList:"#3c3c43",v2DrawerListActive:k.indigo.base,v2AppBarBackground:"#ffffff",v2SnackbarBackground:"#171717"},variables:{"high-emphasis-opacity":"1.0","v2-content-color":"#3c3c43","v2-snackbar-border":"none"}},wt={dark:!0,colors:{background:"#121212",primary:k.indigo.lighten4,secondary:k.indigo.darken4,positive:k.green.lighten2,negative:k.red.lighten1,v2DrawerBackground:"#171717",v2DrawerList:"#bcbcbc",v2DrawerListActive:k.blue.lighten2,v2AppBarBackground:"#171717",v2SnackbarBackground:"#171717"},variables:{"high-emphasis-opacity":"0.86","v2-content-color":"rgba(255, 255, 245, .86)","v2-snackbar-border":"1px solid #3c3c43"}},xt={themes:{defaultTheme:"light",light:_t,dark:wt},variations:{colors:["primary","secondary","positive","negative"],lighten:0,darken:0}},P=F({__name:"DifferenceValue",props:X({value:null,strong:null,positiveClass:null,negativeClass:null,strongClass:null,tag:null},{positiveClass:["text-positive"],negativeClass:["text-negative"],strongClass:["font-weight-bold"],tag:"span"}),setup(t){const u=t.tag;function h(i){return i===0?"":i>0?`+${V(i)}`:`${V(i)}`}function c(i){return i===0?[""]:i>=t.strong?[...t.positiveClass,...t.strongClass]:i<=-t.strong?[...t.negativeClass,...t.strongClass]:i>0?[...t.positiveClass]:[...t.negativeClass]}return(i,g)=>(f(),L(m(u),{class:Z(c(i.value))},{default:r(()=>[T(B(h(i.value)),1)]),_:1},8,["class"]))}});var O={exports:{}};(function(t,u){(function(h,c){t.exports=c()})(ht,function(){return function(h,c,i){c.prototype.isBetween=function(g,p,d,y){var n=i(g),_=i(p),S=(y=y||"()")[0]==="(",$=y[1]===")";return(S?this.isAfter(n,d):!this.isBefore(n,d))&&($?this.isBefore(_,d):!this.isAfter(_,d))||(S?this.isBefore(n,d):!this.isAfter(n,d))&&($?this.isAfter(_,d):!this.isBefore(_,d))}}})})(O);var kt=O.exports;const Ct=pt(kt),Bt={key:0},St={scope:"col",class:"px-2 text-right font-weight-bold"},Dt={key:0,scope:"col",class:"px-2 text-right font-weight-bold"},At={scope:"row",class:"channel-name-head pl-4 pr-2"},Nt={class:"channel-name-box"},Vt={class:"channel-name-text"},$t={key:0,class:"live-badge has-live"},Lt={key:1,class:"live-badge has-live-to-start-soon"},Tt={key:2,class:"live-badge has-live-before-start"},Pt={class:"px-2 text-h6"},Ft={key:0},Ut={colspan:"4",class:"pa-4 text-center"},Et={key:1},It={class:"text-right text-h6"},Mt={scope:"row",class:"pl-4 pr-2 text-right text-body-1 font-weight-bold"},Ht={class:"mt-n4"},jt={class:"mt-n4"},Yt={class:"mt-n4"},zt={class:"px-2"},Ot=F({__name:"StatTable",props:{channels:null,latestStreamings:null,type:null,activeOnly:{type:Boolean}},setup(t){b.extend(Ct);const u=dt({interval:5e3});function h(){switch(t.type){case"subscriber":return"登録数";case"view":return"再生数";case"video":return"動画数"}}function c(a){switch(t.type){case"subscriber":return a.statistics.subscriberCount;case"view":return a.statistics.viewCount;case"video":return a.statistics.videoCount}}function i(a){switch(t.type){case"subscriber":return a.statistics.subscriberCountPerHour;case"view":return a.statistics.viewCountPerHour;case"video":return a.statistics.videoCountPerHour}}function g(a){switch(t.type){case"subscriber":return a.statistics.subscriberCountPerDay;case"view":return a.statistics.viewCountPerDay;case"video":return a.statistics.videoCountPerDay}}function p(){switch(t.type){case"subscriber":return 100;case"view":return 1e3;case"video":return 10}}function d(a){return a>=1e3?a+10**(BigInt(a).toString().length-3)-1:a}function y(){const a=A(t.channels,c);return Math.round(a+(A(t.channels,e=>d(c(e)))-a)/2)}function n(a){return t.activeOnly&&typeof a.activityEndDate=="string"?b().isBefore(a.activityEndDate):!0}function _(a){const e=t.latestStreamings.find(w=>w.channelId===a);return typeof e<"u"&&e.success&&e.isLiveBroadcast===!0&&b(u.value).isAfter(e.startedAt)}function S(a){const e=t.latestStreamings.find(w=>w.channelId===a);return typeof e<"u"&&e.success&&e.isLiveBroadcast===!0&&b(u.value).isBetween(e.startedAt,b(e.startedAt).add(-1,"hour"))}function $(a){const e=t.latestStreamings.find(w=>w.channelId===a);return typeof e<"u"&&e.success&&e.isLiveBroadcast===!0&&b(u.value).isBetween(e.startedAt,b(e.startedAt).add(-3,"hour"))}return(a,e)=>{const w=l("v-img"),U=l("v-avatar"),E=l("v-list-item"),D=l("v-progress-circular"),H=l("v-btn"),j=l("v-card-text"),I=l("v-timeline-item"),q=l("v-timeline"),G=l("v-spacer"),J=l("v-card-actions"),K=l("v-card"),Q=l("v-dialog"),W=l("v-table");return f(),L(W,{density:"compact",hover:""},{default:r(()=>[t.channels.length!==0?(f(),x("thead",Bt,[o("tr",null,[e[0]||(e[0]=o("th",{scope:"col",class:"pl-4 pr-2"}," ",-1)),o("th",St,B(h()),1),t.type==="subscriber"?(f(),x("th",Dt,"1時間")):C("",!0),e[1]||(e[1]=o("th",{scope:"col",class:"pl-2 pr-4 text-right font-weight-bold"},"24時間",-1))])])):C("",!0),o("tbody",null,[(f(!0),x(et,null,tt(t.channels.filter(n),v=>(f(),x("tr",{class:"channel text-right",key:v.id},[o("th",At,[s(E,{class:"channel-name text-left px-0",href:`https://www.youtube.com/${v.customUrl}`,ripple:!1,slim:""},{title:r(()=>[o("div",Nt,[o("span",Vt,B(v.name),1)])]),prepend:r(()=>[_(v.id)?(f(),x("div",$t)):S(v.id)?(f(),x("div",Lt)):$(v.id)?(f(),x("div",Tt)):C("",!0),s(U,{class:"avatar",color:v.color.key,variant:"outlined",size:"small"},{default:r(()=>[s(w,{src:v.thumbnails.default.url,alt:v.fullname},null,8,["src","alt"])]),_:2},1032,["color"])]),_:2},1032,["href"])]),o("td",Pt,B(m(V)(c(v))),1),t.type==="subscriber"?(f(),L(P,{key:0,class:"px-2 text-h6",value:i(v),strong:p(),tag:"td"},null,8,["value","strong"])):C("",!0),s(P,{class:"pl-2 pr-4 text-h6",value:g(v),strong:p(),tag:"td"},null,8,["value","strong"])]))),128)),t.channels.length===0?(f(),x("tr",Ft,[o("td",Ut,[s(D,{color:"primary",indeterminate:""})])])):C("",!0)]),t.channels.length!==0?(f(),x("tfoot",Et,[o("tr",It,[o("th",Mt,[t.type==="subscriber"?(f(),L(Q,{key:0,"max-width":"640"},{activator:r(({props:v})=>[s(H,st(v,{icon:"mdi-information-outline",variant:"plain",density:"compact","aria-label":"チャンネル登録者数について"}),null,16)]),default:r(({isActive:v})=>[s(K,{title:"チャンネル登録者数について"},{default:r(()=>[s(j,null,{default:r(()=>e[2]||(e[2]=[o("p",null," YouTube の制約により、チャンネル登録者数の正確な数値はチャンネルの所有者のみに開示されます。 それ以外の利用者には数値の上位3桁のみが開示されます。 ",-1),o("p",null," したがって、このサイトで表示している数値は上位3桁のみの最小値であり、正確な数値はこれ以上となります。 下記の数値は合計値の参考としてお考えください。 ",-1)])),_:1}),s(j,null,{default:r(()=>[s(q,{class:"text-center",direction:"horizontal",side:"end",size:"small",density:"compact"},{default:r(()=>[s(I,{icon:"mdi-flag-checkered","dot-color":"green"},{default:r(()=>[o("div",Ht,[o("p",null,B(m(V)(m(A)(t.channels,c))),1),e[3]||(e[3]=o("div",{class:"font-weight-bold text-body-2"},"最小値",-1))])]),_:1}),s(I,{icon:"mdi-flag-checkered","dot-color":"orange-darken-1"},{default:r(()=>[o("div",jt,[o("p",null,B(m(V)(y())),1),e[4]||(e[4]=o("div",{class:"font-weight-bold text-body-2"},"平均値",-1))])]),_:1}),s(I,{icon:"mdi-flag-checkered","dot-color":"red"},{default:r(()=>[o("div",Yt,[o("p",null,B(m(V)(m(A)(t.channels,Y=>d(c(Y))))),1),e[5]||(e[5]=o("div",{class:"font-weight-bold text-body-2"},"最大値",-1))])]),_:1})]),_:1})]),_:1}),s(J,null,{default:r(()=>[s(G),s(H,{text:"閉じる",onClick:Y=>v.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1})):C("",!0),e[6]||(e[6]=T(" 合計 "))]),o("td",zt,B(m(V)(m(A)(t.channels,c))),1),t.type==="subscriber"?(f(),L(P,{key:0,class:"px-2",value:m(A)(t.channels,i),strong:p(),tag:"td"},null,8,["value","strong"])):C("",!0),s(P,{class:"pl-2 pr-4",value:m(A)(t.channels,g),strong:p(),tag:"td"},null,8,["value","strong"])])])):C("",!0)]),_:1})}}}),Rt={key:0,class:"update-time"},qt=F({__name:"UpdateTime",props:{time:null},setup(t){const u=N(Number.NaN),h=nt(()=>u.value>=60?`${Math.floor(u.value/60)}分`:`${u.value}秒`);function c(){u.value=b().diff(t.time,"s")}return z(c,1e3),at(()=>t.time,c),(i,g)=>t.time.isValid()&&!Number.isNaN(u.value)?(f(),x("div",Rt,B(`${t.time.format("YYYY/MM/DD HH:mm:ss")} (${h.value}前) 更新`),1)):C("",!0)}}),Gt=F({__name:"StatsApp",setup(t){const u=N([]),h=N([]),c=N(b(Number.NaN)),i=N("subscriber"),g=vt("kemov/stats/activeOnly",!1),p=N(1e3),d=N();return z(async()=>{try{d.value=!1;const y=(await M.get(mt)).data,n=(await M.get(gt)).data;u.value=yt("id",y,n.data),h.value=(await M.get(bt)).data.data,c.value=b.unix(n.fetched_at),p.value=Math.max(Math.floor(600-(b().unix()-n.fetched_at))+5,30)*1e3}catch(y){console.error(`Fetching error. Retrying in 10 minutes: ${y}`),d.value=!0,p.value=600*1e3}},p),(y,n)=>{const _=l("v-icon"),S=l("v-tab"),$=l("v-tabs"),a=l("v-card"),e=l("v-col"),w=l("v-row"),U=l("v-checkbox"),E=l("v-footer");return f(),L(ft,{"page-id":"stats",title:"けもV リアルタイム統計",channels:u.value,"error-snackbar-shown":d.value,"onUpdate:errorSnackbarShown":n[2]||(n[2]=D=>d.value=D)},{footer:r(()=>[s(E,{class:"bg-secondary text-left d-flex flex-column mt-10"},{default:r(()=>n[9]||(n[9]=[o("ul",null,[o("li",null,"およそ10分ごとに自動で更新されます。数値は減少することがあります"),o("li",null,"総再生数と配信・動画数は配信終了後から反映されます"),o("li",null,"このサイトは非公式のファンサイトです")],-1)])),_:1})]),default:r(()=>[s(w,{justify:"center"},{default:r(()=>[s(e,{cols:"12",md:"12",lg:"10",xl:"7",xxl:"6"},{default:r(()=>[s($,{modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=D=>i.value=D),color:"primary","align-tabs":"center",density:"compact"},{default:r(()=>[s(S,{value:"subscriber"},{default:r(()=>[s(_,{start:""},{default:r(()=>n[3]||(n[3]=[T("mdi-account-check")])),_:1}),n[4]||(n[4]=o("span",{class:"font-weight-bold"},"チャンネル登録者数",-1))]),_:1}),s(S,{value:"view"},{default:r(()=>[s(_,{start:""},{default:r(()=>n[5]||(n[5]=[T("mdi-play")])),_:1}),n[6]||(n[6]=o("span",{class:"font-weight-bold"},"総再生数",-1))]),_:1}),s(S,{value:"video"},{default:r(()=>[s(_,{start:""},{default:r(()=>n[7]||(n[7]=[T("mdi-video")])),_:1}),n[8]||(n[8]=o("span",{class:"font-weight-bold"},"配信・動画数",-1))]),_:1})]),_:1},8,["modelValue"]),s(Ot,{channels:u.value,"latest-streamings":h.value,type:i.value,"active-only":m(g)},null,8,["channels","latest-streamings","type","active-only"]),s(a,{class:"text-right px-4 py-2",variant:"flat"},{default:r(()=>[s(qt,{class:"update-time",time:c.value},null,8,["time"])]),_:1})]),_:1})]),_:1}),s(w,null,{default:r(()=>[s(e,null,{default:r(()=>[s(U,{modelValue:m(g),"onUpdate:modelValue":n[1]||(n[1]=D=>ot(g)?g.value=D:null),class:"active-only",label:"活動中の配信者のみ表示","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["channels","error-snackbar-shown"])}}}),Jt=rt(Gt,[["__scopeId","data-v-7ee1e910"]]),Kt=lt({components:ct,directives:ut,icons:{defaultSet:"mdi"},theme:xt}),R=it(Jt);R.use(Kt);R.mount("#app");
